---
layout: post
title: "启动优化"
date: 2019-05-06
description: "启动优化"
tag: 底层原理
---


<h6>
  版权声明：本文为博主原创文章，未经博主允许不得转载。
  <a target="_blank" href="https://jianghuhike.github.io/1956.html">
  原文地址：https://jianghuhike.github.io/1956.html 
  </a>
</h6>



## 目录
- [main函数之前](#content1)   
- [main函数之后](#content2)   




<!-- ************************************************ -->
## <a id="content1"></a>main函数之前

**一、冷启动与热启动**

我们一般认为杀掉程序，再次启动程序就是冷启动。程序在后台时再回到前台就是热启动。

但实际上杀掉进程后再启动进程并不是真正的冷启动，因为程序已经加载到内存中，我们杀掉程序并不能清除内存中已加载的部分。

杀掉进程，启动5-6个其它进程，覆盖之前的内存，再次启动该进程才能保证是百分百的冷启动。


**二、配置环境变量**

<img src="/images/underlying/start1.png" alt="img">

配置了该环境变量后程序在启动时就会打印启动时间

|Total pre-main time: 1.0 seconds (100.0%)|

|dylib loading time	    | 179.81 milliseconds (17.8%)|	动态库加载时间  |
|rebase/binding time	    | 197.74 milliseconds (19.6%)|	内部指针修正（ASLR）/外部指针绑定符号绑定（符号绑定）|
|ObjC setup time		| 255.18 milliseconds (25.3%)|	类注册时间
|initializer time		| 373.84 milliseconds (37.1%)|	load方法耗时，并不是initializer方法|
|slowest intializers  |||
|libSystem.B.dylib 	|  10.84 milliseconds (1.0%)|		系统库|
|libglInterpose.dylib	|  69.62 milliseconds (6.9%)	|	调试相关|
|mars  | 43.44 milliseconds (4.3%)	|	系统库|
|WeChat	| 158.86 milliseconds (15.7%)|	主程序mach-0|





**三、如何优化**

|优化|

|dylib loading time |	减少动态库的数量不要超过6个|
|rebase/binding time|	减少项目中的类，有统计去掉2万个类可减少800毫秒所以优化空间较小。但项目中弃用的类要尽量清除|
|ObjC setup time	|	减少项目中的类，有统计去掉2万个类可减少800毫秒所以优化空间较小。但项目中弃用的类要尽量清除|
|initializer time	|	代码尽量不要在load方法，放在initializer方法，但要注意多次调用问题|



<!-- ************************************************ -->
## <a id="content2"></a>main函数之后








----------
>  行者常至，为者常成！


