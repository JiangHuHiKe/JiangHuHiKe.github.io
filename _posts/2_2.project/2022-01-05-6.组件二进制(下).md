---
layout: post
title: "6.组件二进制(下)"
date: 2022-01-06
tag: 工程化
---


## 目录
- [插件介绍](#content1)   




<!-- ************************************************ -->
## <a id="content1">插件介绍</a>

#### **一、插件如何调试**

cocoapods在执行命令的时候，比如 pod install    
内部会加载插件，同时会扫描gems目录下安装的gem，在每个gem里边会去查找cocoapods_plugin.rb文件    
如果存在就进行加载，就会作为cocoapods的三方插件  

launch.json文件如下：
```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Debug Cat Bin",
            "type": "rdbg",
            "request": "launch",
            "script": "${workspaceRoot}/bin/cat_bin",
            "args":[
                "install", "--project-directory=${workspaceRoot}/../TestApp"
            ]
        }
    ]
}
```


cat_bin文件内的代码  
```ruby
# 打印所有 gem 的最新版本的规范
Gem::Specification.latest_specs(true).map do |spec|
  puts spec.full_name
end


# 这一行的条件检查是在确保当前文件是直接被执行而不是被其他文件引用时才执行以下的代码块
# $PROGRAM_NAME 是 Ruby 程序当前运行的文件名
# __FILE__ 是当前文件的路径
if $PROGRAM_NAME == __FILE__

  # ENV['BUNDLE_GEMFILE'] 是一个环境变量，用于指定 Bundler 应该使用的 Gemfile 路径。
  ENV['BUNDLE_GEMFILE'] = File.expand_path('../Gemfile', __dir__)

  # require 'bundler/setup' 是加载 Bundler 的设置文件，它通常用于确保项目的 Gemfile 中列出的依赖被正确加载和设置。
  # 这一行的作用是确保在运行当前脚本时，Bundler 能够加载并设置项目的 gem 环境，以及正确解析和加载 Gemfile 中的依赖项。
  require 'bundler/setup'
end

# 可以对比下再bundler/setup之后跟之前有什么区别
Gem::Specification.latest_specs(true).map do |spec|
  puts spec.full_name
end

Pod::Command.run(ARGV)
```

cocoapods_plugin.rb文件内的代码,插件的hook方法调用   
```ruby
module Pod
    module CocoaPodsCatBinHook
      HooksManager.register('cocoapods-cat-bin', :pre_install) do |context, option|
        #
        puts "lxy:pre_install"
        # p context, option
      end
      HooksManager.register('cocoapods-cat-bin', :pre_integrate) do |context, option|
        #
        puts "lxy:pre_integrate"
        # p context, option
      end
      HooksManager.register('cocoapods-cat-bin', :post_install) do |context, option|
        #
        puts "lxy:post_install"
        # p context, option
      end
      HooksManager.register('cocoapods-cat-bin', :post_integrate) do |context, option|
        #
        puts "lxy:post_integrate"
        p context, option
      end
    end
end
```

TestApp工程内的podfile文件
```ruby
platform :ios, '9.0'

plugin 'cocoapods-cat-bin'
target 'TestApp' do
  use_frameworks!
  pod 'SDWebImage'
end
```

在vscode中进行调试时，会进入cocoapods_plugin.rb文件内注册的插件回调     
在回调内我们可以调用我们gem工程中的命令    

```
pre_install:Pod下载之后但在安装之前对Pod进行任何更改 

pre_integrate:将生成的Xcode项目写入磁盘之前 

post_install:生成的 Xcode 项目写入磁盘之前对其进行任何最后更改 

post_integrate:在项目写入磁盘后进行更改
```
 


#### **二、讲解过程中的截图**

<span style="color:red;font-weight:bold">咱也不知道老师到底在讲啥，先做记录吧</span>

<span style="color:red;font-weight:bold">大概意思是不会采用这种插件方式，这里只是介绍下插件，要采用命令的方式</span>

<span style="color:red;font-weight:bold">先往后听课。。。</span>

<img src="/images/project/19.png">

<img src="/images/project/18.png">


<img src="/images/project/19.png">


rake install:local 命令会将开发中的gem安装到本地进行调试    




----------
>  行者常至，为者常成！


