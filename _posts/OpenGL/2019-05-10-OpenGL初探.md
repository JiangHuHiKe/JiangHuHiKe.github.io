---
layout: post
title: "1、OpenGL初探"
date: 2019-05-10
description: "OpenGL初探"
tag: OpenGL
---
<h6>版权声明：本文为博主原创文章，转载请注明出处。</h6>



## 目录
- [图形API简介](#content1)   
- [OpenGL专业名词解析](#content2)   
- [坐标系统](#content3)   
- [图片的解压缩和渲染过程](#content4)   





<!-- ************************************************ -->
## <a id="content1"></a>图形API简介

**一、图形API**

**OpenGL(Open Graphics Library)** 是一个跨编程语言、跨平台的编程图形程序接口，它将计算机的资源抽象为一个个OpenGL的对象，对这些资源的操作抽象为一个个的OpenGL指令

**OpenGL ES(OpenGL for Embedded Systems)** 是OpenGL三维图形API的子集，针对手机、PAD、和游戏主机等嵌入式设备而设计，去除了许多不必要和性能较低的API接口。

**Metal**  : Metal: Apple为游戏开发者推出了新的平台技术 Metal，该技术能够为 3D图像提⾼10倍的渲染性能.Metal 是Apple为了解决3D渲染而推出的框架


**二、图形API能解决什么问题？**

简单来说就是实现图形的底层渲染

1. ⽐如在游戏开发中,对于游戏场景/游戏人物的渲染

2. ⽐如在⾳视频开发中,对于视频解码后的数据渲染

3. ⽐如在地图引擎,对于地图上的数据渲染

4. ⽐如在动画中,实现动画的绘制

5. ⽐如在视频处理中,对视频加上滤镜效果

OpenGL /OpenGL ES/ Metal 在任何项⽬中解决问题的本质就是利用GPU芯片来⾼效渲染图形图像. 图形API是iOS开发者唯⼀接近GPU的⽅式.


**三、OpenGL阶段学习什么内容**

1. 熟悉图形图像API中的专有名词 

2. 熟悉图形图像常⽤处理手段,⽐如深度测试等.

3. 熟悉图形渲染流程

4. 熟悉API使⽤


<!-- ************************************************ -->
## <a id="content2"></a>OpenGL专业名词解析

- [参考文章：OpenGL / OpenGL ES 下专业名词解析](https://www.jianshu.com/p/1b09101aa117)


**一、OpenGL 上下文 context**

在应用程序调⽤任何OpenGL的指令之前，首先需要创建一个OpenGL的上下文。

这个上下文是⼀个⾮常庞大的状态机，保存了OpenGL中的各种状态，这也是OpenGL指令执行的基础，

OpenGL指令本质上都是对OpenGL上下⽂这个庞⼤的状态机中的某个状态或者对象进⾏操作，因此，通过对 OpenGL指令的封装，是可以将OpenGL的相关调⽤封装成一个⾯向对象的图形API

由于OpenGL上下⽂是⼀个巨⼤的状态机，切换上下文往往会产⽣较⼤的开销，但是不同的绘制模块，可能需要使用完全独立的状态管理。因此，可以在应⽤程序中分别创建多个不同的上下文，在不同线程中使用不同的上下文，上下文之间共享纹理、缓冲区等资源。这样的方案，会⽐反复切换上下文，或者⼤量修改渲染状态，更加合理高效.


**二、渲染**

将图形/图像数据转换成3D空间图像的操作叫做渲染(Rendering).

**三、顶点数组(VertexArray)和顶点缓冲区(VertexBuffer)**

画图⼀般是先画好图像的⻣架，然后再往⻣架里⾯填充颜色，这对于OpenGL也是⼀样的。顶点数据就是要画的图像的⻣架。和现实中不同的是，OpenGL中的图像都是由图元组成，在OpenGLES中，有3种类型的图元:点、线、三⻆形。

那这些顶点数据最终是存储在哪⾥的呢?开发者可以选择设定函数指针，在调⽤绘制⽅法的时候，直接由内存传入顶点数据，也就是说这部分数据之前是存储在内存当中的，被称为顶点数组。⽽性能更更⾼的做法是，提前分配⼀块显存，将顶点数据预先传⼊到显存当中。这部分的显存，就被称为顶点缓冲区。

顶点指的是我们在绘制⼀个图形时,它的顶点位置数据.⽽这个数据可以直接存储在数组中或者将其缓存到GPU内存中。


**四、管线**

管线，在OpenGL下渲染图形,就会经历⼀个⼀个节点，⽽这样的操作可以理解为管线. ⼤家可以想象成流水线，每个任务类似流水线般执⾏.任务之间有先后顺序. 

管线是⼀个抽象的概念，之所以称之为管线是因为显卡在处理数据的时候是按照一个固定的顺序来的，而且严格按照这个顺序。就像⽔从一根管⼦的一端流到另一端，这个顺序是不能打破的。

管线有固定管线和可编程渲染管线。

固定管线又叫存储着色器，在早期的OpenGL版本,它封装了很多种着⾊器程序块。来帮助开发者完成图形的渲染. 类似于iOS开发会封装很多API,而我们只需要调用,就可以实现功能.不需要关注底层实现原理，但是由于OpenGL的使⽤场景⾮常丰富,固定管线或存储着⾊器⽆法完成每⼀个业务.这时将相关部分开放成可编程.

可编程渲染管线常见的有： 

顶点着色器(VertexShader)，

⽚段着⾊器 (FragmentShader)/像素着⾊器(PixelShader)/片元着色器，

⼏何着⾊器 (GeometryShader)

曲面细分着⾊器(TessellationShader)

可惜的是，直到OpenGLES 3.0，依然只⽀持了顶点着⾊器和片段着⾊器这两个最基础的着⾊器。

着⾊器程序同时包含了顶点着⾊器和⽚段着色器的运算逻辑。在OpenGL进行绘制的时候，⾸先由顶点着⾊器对传⼊的顶点数据进行运算。再通过图元装配，将顶点转换为图元。然后进行光栅化，将图元这种⽮量图形，转换为栅格化数据。最后，将栅格化数据传⼊⽚段着⾊器中进⾏运算。⽚段着⾊器会对栅格化数据中的每⼀个像素进行运算，并决定像素的颜⾊。

**五、GLSL (OpenGL Shading Language)**

OpenGL着⾊语言(OpenGL Shading Language)是⽤来在OpenGL中着⾊编程的语言，也即开发人员写的短⼩的⾃定义程序，他们是在图形卡的GPU (Graphic Processor Unit图形处理理单元)上执⾏的，代替了固定的渲染管线的⼀部分，使渲染管线中不同层次具有可编程性。比如:视图转换、投影转换等。GLSL(GL Shading Language)的着⾊器代码分成2个部分: Vertex Shader(顶点着⾊器)和Fragment(片元着⾊器)

**六、光栅化Rasterization**

顶点数据运算 -> 图元装配将顶点转换为图元 -> 图元矢量图转化为位图（光栅化） 


**七、纹理**

纹理可以理解为图⽚. ⼤家在渲染图形时需要在其编码填充图⽚,为了使得场景更加逼真.⽽这里使⽤的图⽚,就是常说的纹理.但是在OpenGL,我们更加习惯叫纹理,⽽不是图片.

**八、混合(Blending)**

在测试阶段之后，如果像素依然没有被剔除，那么像素的颜色将会和帧缓冲区中颜⾊附着上的颜色进⾏混合，混合的算法可以通过OpenGL的函数进行指定。但是OpenGL提供的混合算法是有限的，如果需要更加复杂的混合算法，⼀般可以通过像素着⾊器进⾏实现，当然性能会⽐原⽣的混合算法差一些.


**九、矩阵**

变换矩阵

例如图形想发⽣平移,缩放,旋转变换.就需要使⽤变换矩阵.

投影矩阵

⽤于将3D坐标转换为⼆维屏幕坐标,实际线条也将在⼆维坐标下进⾏绘制.


**十、渲染上屏/交换缓冲区(SwapBuffer)**

渲染缓冲区⼀般映射的是系统的资源，⽐如窗口。如果将图像直接渲染到窗口对应的渲染缓冲区，则可以将图像显示到屏幕上。

但是，值得注意的是，如果每个窗⼝只有⼀个缓冲区，那么在绘制过程中屏幕进⾏了刷新，窗⼝可能显示出不完整的图像

为了解决这个问题，常规的OpenGL程序⾄少都会有两个缓冲区。显示在屏幕上的称为屏幕缓冲区，没有显示的称为离屏缓冲区。在一个缓冲区渲染完成之后，通过将屏幕缓冲区和离屏缓冲区交换，实现图像在屏幕上的显示

由于显示器的刷新⼀般是逐⾏进⾏的，因此为了防⽌交换缓冲区的时候屏幕上下区域的图像分属于两个不同的帧，因此交换⼀般会等待显示器刷新完成的信号，在显示器两次刷新的间隔中进⾏交换，这个信号就被称为垂直同步信号，这个技术被称为垂直同步

使⽤了双缓冲区和垂直同步技术之后，由于总是要等待缓冲区交换之后再进⾏下⼀帧的渲染，使得帧率⽆法完全达到硬件允许的最⾼水平。为了解决这个问题，引⼊了三缓冲区技术，在等待垂直同步时，来回交替渲染两个离屏的缓冲区，⽽垂直同步发⽣时，屏幕缓冲区和最近渲染完成的离屏缓冲区交换，实现充分利⽤硬件性能的目的



<!-- ************************************************ -->
## <a id="content3"></a>坐标系统

- [参考文章：OpenGL 坐标系解析](https://www.jianshu.com/p/3448f546eac4)



<!-- ************************************************ -->
## <a id="content4"></a>图片的解压缩和渲染过程

- [参考文章：探讨iOS 中图片的解压缩到渲染过程](https://www.jianshu.com/p/72dd074728d8)




----------
>  行者常至，为者常成！


