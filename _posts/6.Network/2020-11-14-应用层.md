---
layout: post
title: "12、应用层"
date: 2020-11-14
description: ""
tag: 网络协议
---



- [参考：【MJ亲授】网络协议从入门到底层原理](https://ke.qq.com/course/2900359)



## 目录

* [应用层的常见协议](#content1)
* [域名（Domain Name）](#content2)
* [DNS（Domain Name System）](#content3)
* [DHCP](#content4)
* [几个问题](#content5)







<!-- ************************************************ -->
## <a id="content1">应用层的常见协议</a>


超文本传输：HTTP、HTTPS        
文件传输：FTP        
电子邮件：SMTP、POP3、IMAP        
动态主机配置：DHCP        
域名系统：DNS        

<!-- ************************************************ -->
## <a id="content2">域名（Domain Name）</a>

#### **一、域名的作用**

由于IP地址不方便记忆，并且不能表达组织的名称和性质，人们设计出了域名（比如baidu.com）        
但实际上，为了能够访问到具体的主机，最终还是得知道目标主机的IP地址       
域名申请注册：[https://wanwang.aliyun.com/](https://wanwang.aliyun.com/)      
那干脆全程直接用域名，不用IP地址？       
IP地址固定4个字节，域名随随便便都至少10几个字节，这无疑会增加路由器的负担，浪费流量       
根据级别不同，域名可以分为       
顶级域名（Top-level Domain，简称TLD）        
二级域名       
三级域名       
...       


#### **二、顶级域名**


**通用顶级域名（General Top-level Domain，简称gTLD）**        
.com（公司）     
.net（网络机构）     
.org（组织机构）     
.edu（教育）            
.gov（政府部门）     
.int（国际组织）     
...           

**国家及地区顶级域名（Country Code Top-level Domain，简称ccTLD）**   

.cn（中国）       
.jp（日本）       
.uk（英国）       
...       

**新通用顶级域名（New Generic Top-level Domain，简称：New gTLD）**

.vip      
.xyz      
.top      
.club      
.shop      
...      


#### **三、二级域名**

二级域名是指顶级域名之下的域名

在通用顶级域名下，它一般指域名注册人的名称          
例如google、baidu、microsoft等     
www.google.com      
wwww.baidu.com      
www.microsoft.com       

在国家及地区顶级域名下，它一般指注册类别的        
例如com、edu、gov、net等    
xxxx.com.cn      
xxxx.edu.cn       
xxxx.gov.cn      
xxxx.net.cn       

<img src="/images/Network/ap1.png" alt="img">




<!-- ************************************************ -->
## <a id="content3"></a>DNS（Domain Name System）

**一、DNS协议**

DNS的全称是：Domain Name System，译为：域名系统        
利用DNS协议，可以将域名（比如baidu.com）解析成对应的IP地址（比如220.181.38.148）        
DNS可以基于UDP协议，也可以基于TCP协议，服务器占用53端口       

<img src="/images/Network/ap2.png" alt="img">


客户端首先会访问最近的一台DNS服务器（也就是客户端自己配置的DNS服务器）       
所有的DNS服务器都记录了DNS根域名服务器的IP地址       
上级DNS服务器记录了下一级DNS服务器的IP地址       
全球一共13台IPv4的DNS根域名服务器、25台IPv6的DNS根域名服务器       

example.microsoft.com 其实是example.microsoft.com. 被省略的.是根域名

根域名：.      
顶级域名：.com      
二级域名：.microsoft      
三级域名：example       

**二、DNS常用命令**

ipconfig /displaydns：查看DNS缓存记录       
ipconfig /flushdns：清空DNS缓存记录       
ping 域名       
nslookup 域名       


<!-- ************************************************ -->
## <a id="content4"></a>DHCP

**一、IP地址的分配**

IP地址按照分配方式，可以分为：静态IP地址、动态IP地址      
静态IP地址            
✓ 手动设置      
✓ 适用场景：不怎么挪动的台式机（比如学校机房中的台式机）、服务器等      

动态IP地址       
✓ 从DHCP服务器自动获取IP地址     
✓ 适用场景：移动设备、无线设备等     


**二、DHCP**

DHCP（Dynamic Host Configuration Protocol），译为：动态主机配置协议       
DHCP协议基于UDP协议，客户端是68端口，服务器是67端口        
DHCP服务器会从IP地址池中，挑选一个IP地址“出租“给客户端一段时间，时间到期就回收它们        
平时家里上网的路由器就可以充当DHCP服务器        

**三、DHCP分配IP地址的四个阶段**

DISCOVER：发现服务器       
发广播包（源IP是0.0.0.0，目标IP是255.255.255.255，目标MAC是FF:FF:FF:FF:FF:FF）        

OFFER：提供租约       
服务器返回可以租用的IP地址，以及租用期限、子网掩码、网关、DNS等信息       
注意：这里可能会有多个服务器提供租约       

REQUEST：选择IP地址       
客户端选择一个OFFER，发送广播包进行回应       

ACKNOWLEDGE：确认       
被选中的服务器发送ACK数据包给客户端 

至此，IP地址分配完毕       

<img src="/images/Network/ap3.png" alt="img">

**四、DHCP细节**

DHCP服务器可以跨网段分配IP地址么？（DHCP服务器、客户端不在同一个网段）     
可以借助DHCP中继代理（DHCP Relay Agent）实现跨网段分配IP地址      

自动续约      
客户端会在租期不足的时候，自动向DHCP服务器发送REQUEST信息申请续约      

常用命令        
ipconfig /all：可以看到DHCP相关的详细信息，比如租约过期时间、DHCP服务器地址等        
ipconfig /release：释放租约        
ipconfig /renew：重新申请IP地址、申请续约（延长租期）        



<!-- ************************************************ -->
## <a id="content5">几个问题</a>

#### **一、为什么一个域名可以解析出多个ip地址？**

一个域名可以解析出多个IP地址的主要原因是负载均衡和故障恢复。这种配置可以提高网站的性能、可用性和容错能力。以下是一些常见的情况：

**负载均衡：**通过将多个IP地址与一个域名相关联，可以将流量分散到不同的服务器上，实现负载均衡。这有助于分摊服务器负载，提高网站性能，并防止单点故障。

**地理位置分发：**通过为不同地理位置的用户提供相应地区的服务器IP地址，可以降低延迟并提高访问速度。这通常被称为地理负载均衡。

**故障恢复：**如果一个服务器发生故障，DNS解析可以提供其他可用服务器的IP地址，确保服务的连续性。这种配置被称为故障转移或故障恢复。

**CDN（内容分发网络）：**使用CDN服务时，一个域名可能会解析到多个CDN节点的IP地址。这样可以将内容就近提供给用户，减少加载时间。

**服务版本控制：**某些情况下，不同版本的服务可能部署在不同的服务器上。通过将不同版本的IP地址与域名关联，可以控制用户访问哪个版本的服务。

这种多IP地址解析的方式通常是通过DNS记录中的多个A记录或CNAME记录来实现的。当客户端请求域名的IP地址时，DNS服务器会返回这些记录中的一个地址，客户端可以选择其中一个地址进行连接。负载均衡器或其他网络设备会根据配置决定如何分发流量。

#### **二、一个域名从无到注册到被使用经历了哪些步骤**

下面是一个域名从无到注册到被使用的一般步骤的概要，以"example.com"为例：    

**1、选择并验证域名：**    
选择域名： 您决定注册一个域名，例如"example.com"。      
验证域名可用性： 在域名注册服务商的网站上，通过域名搜索功能验证选择的域名是否可用。  


**2、选择注册服务商：**      
选择服务商： 选择一个域名注册服务商（如GoDaddy、Namecheap、Google Domains）来注册域名。       
创建账户： 在选定的服务商处创建账户。      

**3、购买域名：**   
添加到购物车： 将选定的域名添加到购物车。    
选择注册期限： 选择注册的年限，通常以年为单位。    
完成购买： 提供支付信息并完成购买。    

**4、提供联系信息：**   
WHOIS信息： 提供与域名相关的WHOIS信息，包括域名所有者、技术联系人等。   
隐私保护： 可选择开启隐私保护服务，以隐藏WHOIS信息。


<span style="color:red;font-weight:bold">5、选择权威域名服务器：</span>        
使用默认服务器或自定义： 您可以选择使用注册服务商提供的默认权威域名服务器或配置自己的服务器。    

**6、登录域名管理界面：**      
使用账户登录： 使用注册服务商提供的账户信息登录到域名管理界面。    


<span style="color:red;font-weight:bold">7、设置DNS记录：</span>      
A记录、AAAA记录： 配置将域名映射到IPv4和IPv6地址的记录。     
CNAME记录： 如果有子域名，配置别名记录。   
DNS记录存储在权威域名服务器上     
ip地址通常是由你购买主机服务的厂家来提供或者你自己购买的ip地址                 


**8、保存更改：**     
提交更改： 确保在域名管理界面上保存或提交更改。    
DNS传播： DNS记录的更新可能需要一些时间在全球范围内传播。
xy:如果哪天你的ip地址发生了改变，需要你自己登录管理界面进行更换或添加          

**9、等待DNS生效：**     
等待传播时间： 等待DNS记录生效，以确保域名能够正确解析到配置的IP地址。     

**10、使用域名：**     
网站托管： 将网站或应用程序托管到与域名关联的服务器上。   
邮箱设置： 配置与域名关联的邮箱服务。   
其他服务： 根据需求配置域名与其他在线服务的关联。    

通过这些步骤，域名从选择、注册，到最终被使用，经历了一系列的设置和配置过程，确保了域名能够正确地解析到相应的服务器或服务。




----------
>  行者常至，为者常成！


