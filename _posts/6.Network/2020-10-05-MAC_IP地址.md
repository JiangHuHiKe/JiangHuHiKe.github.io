---
layout: post
title: "3、MAC_IP地址"
date: 2020-10-05
description: ""
tag: 网络协议
---



- [参考：【MJ亲授】网络协议从入门到底层原理](https://ke.qq.com/course/2900359)



## 目录

* [快速浏览](#content0)
* [MAC地址](#content1)
* [IP地址](#content2)
* [子网](#content3)
* [超网](#content4)



<!-- ************************************************ -->
## <a id="content0">快速浏览</a>
#### **一、mac地址**  
6个字节 前三厂商标识后三自行分配   

#### **二、IP地址+子网掩码**   
网络号 + 主机号     
主机号全0代表网段    
主机号全1代表广播向这个网段所有主机发信息           

#### **三、网址分类**    
A类    
B类:128开头 128.0.0.0是第一个B类网段    
C类:192开头 192.0.0.0是第一个C类网段    

#### **四、等长子网划分**  
子网、超网、等长子网划分、变长子网划分    
不管是什么怎么划分，都是在A类、B类、C类的基础上进行的    
是否在一个网段通过子网掩码计算就可以了   
<span style="color:red;font-weight:bold">ip地址 + 子网掩码 搞定一切</span>     

下面的两个主机不在同一个网段     
192.168.0.0/25  和  192.168.0.128/25     

#### **五、一个很好的例子**
<img src="/images/Network/net10.png">
计算机0向计算机1发送数据，需要先看是否在同一个网段：拿自己的子网掩码与对方的ip地址进行计算(拿不到对方的子网掩码)    
计算机0的网段：192.168.0.0/24     
计算机1的网段：192.168.10.0/24    
不在同一个网段不是路由连接不能发送消息    

<img src="/images/Network/net11.png">
计算机1向计算机0发送消息，网段计算   
计算机1的网段：192.168.0.0/16   
计算机2的网段：192.168.0.0/16   
虽然计算后是同一个网段，但仍不能正常通讯，因为消息能发出但回不来    



<!-- ************************************************ -->
## <a id="content1"></a>MAC地址

**一、介绍**

每一个网卡都有一个6字节（48bit的MAC地址（Media Access Control Address） 

全球唯一，固化在了网卡的ROM中，由IEEE802标准规定

<img src="/images/Network/mac1.png" alt="img">

前3字节：OUI（Organizationally Unique Identifier），组织唯一标识符     
由IEEE的注册管理机构分配给厂商

后3字节：网络接口标识符     
由厂商自行分配



OUI查询     
- [http://standards-oui.ieee.org/oui.txt](http://standards-oui.ieee.org/oui.txt)     
- [https://mac.51240.com](https://mac.51240.com)     

**二、MAC地址的表示格式**

Windows     
40-55-82-0A-8C-6D

Linux、Android、Mac、iOS     
40:55:82:0A:8C:6D     

Packet Tracer     
4055.820A.8C6D     

当48位全为1时，代表广播地址     
FF-FF-FF-FF-FF-FF     


**三、MAC地址操作**


查看MAC地址：ipconfig /all


修改MAC地址     

<img src="/images/Network/mac2.png" alt="img">

更改适配器选项 - 属性 - 配置 - 高级 - 网络地址    
填写的时候需要把减号（-）去掉    

有时可以通过修改MAC地址蹭网

**四、MAC地址的获取**

当不知道对方主机的MAC地址时，可以通过发送ARP广播获取对方的MAC地址      
获取成功后，会缓存IP地址、MAC地址的映射信息，俗称：ARP缓存      
通过ARP广播获取的MAC地址，属于动态（dynamic）缓存      
存储时间比较短（默认是2分钟），过期了就自动删除  

相关命令      
arp -a [主机地址]：查询ARP缓存      
arp -d [主机地址]：删除ARP缓存      
arp -s 主机地址 MAC地址：增加一条缓存信息（这是静态缓存，存储时间较久，不同系统的存储时间不同）      



<!-- ************************************************ -->
## <a id="content1"></a>IP地址

**一、介绍**

IP地址（Internet Protocol Address）：互联网上的每一个主机都有一个IP地址     
最初是IPv4版本，32bit（4字节），2019年11月25日，全球的IP地址已经用完     
后面推出了IPv6版本，128bit（16字节）     

以后不指定版本，默认就是IPv4版本，后面再单独讨论IPv6

1100 0000 1010 1000 0000 0001 0000 1010       

|第1部分 |第2部分 |第3部分 |第4部分|
|1100 0000| 1010 1000| 0000 0001 |0000 1010|
|192 |168 |1 |10|


**二、IP地址的组成**

IP地址由2部分组成：网络标识（网络ID）、主机标识（主机ID）      
通过子网掩码（subnet mask）可以得知网络ID 、主机ID       
主机所在的网段 = 子网掩码 & IP地址       
网段其实       

计算机和其他计算机通信前，会先判断目标主机和自己是否在同一网段       
同一网段：不需要由路由器进行转发       
不同网段：交由路由器进行转发       


**三、IP地址的分类**

A类地址：默认子网掩码是255.0.0.0

|8bit| 24bit|
|网络ID|主机ID|
|0开头||


B类地址：默认子网掩码是255.255.0.0  

|16bit| 16bit|
|网络ID|主机ID|
|10开头||

C类地址：默认子网掩码是255.255.255.0

|24bit| 8bit|
|网络ID|主机ID|
|110开头||


D类地址：以1110开头，多播地址       
E类地址：以1111开头，保留为今后使用       
只有A\B\C类地址才能分配给主机       
主机ID为全0，表示主机所在的网段       
主机ID为全1，表示主机所在网段的全部主机（广播）       
可以尝试用ping给某个网段的全部主机发数据     


**一、A类地址**

<img src="/images/Network/ip1.png" alt="img">

网络ID     
0不能用，127作为保留网段。其中127.0.0.1是本地环回地址（Loopback），代表本机地址     
可以分配给主机的     
✓ 第1部分的取值范围是：1~126(0000 0001 ~ 0111 1110)    
A类网址共有网段126个       

主机ID      
第2、3、4部分的取值范围是：0~255      
每个A类网络能容纳的最大主机数是：256 * 256 * 256 – 2 = 2的24次方 – 2 = 16777214  

||网络ID|主机ID|
|起始|00000000 |00000000 00000000 00000000|
|终止|01111111 |11111111 11111111 11111111|
|数量|126 = 128 - 1(去全0) - 1(去127)|16777214 = 256 * 256 * 256 - 1(全0网段) - 1(全1广播)|
|IP地址数量|2113928964 = 126 * 16777214| |



**二、B类地址**

<img src="/images/Network/ip2.png" alt="img">

网络ID      
可以分配给主机的      
第1部分的取值范围是：128~191(1000 0000 ~ 1011 1111)      
第2部分的取值范围是：0~255(0000 0000 ~ 1111 1111)    
第1和2部分整体的取值范围是：32768~49151(10000000 00000000 ~ 10111111 11111111)     
B类网址共有网段16384个      

主机ID      
第3、4部分的取值范围是：0~255      
每个B类网络能容纳的最大主机数是：256 * 256 – 2 = 2的16次方 – 2 = 65534 

||网络ID|主机ID|
|起始|10000000 00000000| 00000000 00000000|
|终止|10111111 11111111| 11111111 11111111|
|数量|16384 = 64 * 256|65534 = 256 * 256 - 1(全0网段) - 1(全1广播)|
|IP地址数量|1073709056 = 16384 * 65534| |

**三、C类地址**

<img src="/images/Network/ip3.png" alt="img">


网络ID     
可以分配给主机的     
第1部分的取值范围是：192~223(1100 0000 ~ 1101 1111)          
第2、3部分的取值范围是：0~255(0000 0000 ~ 1111 1111)            
C类网址共有网段2097152个

主机ID     
第4部分的取值范围是：0~255(0000 0000 ~ 1111 1111)     
每个C类网络能容纳的最大主机数是：256 – 2 = 254     


||网络ID|主机ID|
|起始|11000000 00000000 00000000| 00000000|
|终止|11011111 11111111 11111111| 11111111|
|数量|2097152 = 32 * 256 * 256|254 = 256 - 1(全0网段) - 1(全1广播)|
|IP地址数量|532676608 = 2097152 * 254| |
     

**四、D类地址**

<img src="/images/Network/ip4.png" alt="img">

D类地址：没有子网掩码，用于多播（组播）地址     
第1部分取值范围是：224~239      


**五、E类地址**

<img src="/images/Network/ip5.png" alt="img">

E类地址：保留为今后使用     
第1部分取值范围是：240~255     

**六、取值范围对比**

|地址|起始|终止|
|A类地址|00000000 00000000 00000000 00000000  |  0  **1111111 11111111 11111111 11111111**|
|B类地址|10000000 00000000 00000000 00000000  |  10  **111111 11111111 11111111 11111111**|
|C类地址|11000000 00000000 00000000 00000000  |  110  **11111 11111111 11111111 11111111**|
|D类地址|11100000 00000000 00000000 00000000  |  1110  **1111 11111111 11111111 11111111**|
|E类地址|11110000 00000000 00000000 00000000  |  1111  **1111 11111111 11111111 11111111**|

对比我们可以看出A B C D类IP地址的数量基本是上个的一半，E类IP地址数量与D类一致


<!-- ************************************************ -->
## <a id="content3"></a>子网

**一、子网掩码CIDR表示**


CIDR（Classless Inter-Domain Routing）：无类别域间路由    
子网掩码的CIDR表示方法    
192.168.1.100/24，代表子网掩码有24个1，也就是255.255.255.0    
123.210.100.200/16，代表子网掩码有16个1，也就是255.255.0.0    

- [计算工具：https://www.sojson.com/convert/subnetmask.html](https://www.sojson.com/convert/subnetmask.html)


**二、为什么要子网划分**

如果需要让200台主机在同一个网段内，可以分配一个C类网段，比如192.168.1.0/24      
共254个可用IP地址：192.168.1.1~192.168.1.254      
多出54个空闲的IP地址，这种情况并不算浪费资源   

如果需要让500台主机在同一个网段内，那就分配一个B类网段，比如191.100.0.0/16      
共65534个可用IP地址：191.100.0.1~191.100.255.254      
多出65034个空闲的IP地址，这种情况属于极大的浪费资源   

如何尽量避免浪费IP地址资源？      
<span style="font-weight:bold">合理进行子网划分</span>

**三、子网划分分类**

子网划分：借用主机位作子网位，划分出多个子网    

可以分为    
等长子网划分：将一个网段等分成多个子网，每个子网的可用IP地址数量是一样的    
变长子网划分：每个子网的可用IP地址数量可以是不一样的    

- [子网划分器：http://www.ab126.com/web/3552.html](http://www.ab126.com/web/3552.html) 

子网划分的步骤    
确定子网的子网掩码长度    
确定子网中第1个、最后1个主机可用的IP地址    


**四、等长子网划分**

**1、C类等长子网划分 等分成2个子网**

<img src="/images/Network/ip6.png" alt="img">

A子网    
子网掩码：255.255.255.128/25    
主机可用IP地址：192.168.0.1~192.168.0.126    

B子网    
子网掩码：255.255.255.128/25    
主机可用IP地址：192.168.0.129~192.168.0.254 

**2、C类等长子网划分 等分成4个子网**

<img src="/images/Network/ip7.png" alt="img">


4个子网的子网掩码都是：255.255.255.192/26      

A子网的主机可用IP地址      
192.168.0.1~192.168.0.62  

B子网的主机可用IP地址      
192.168.0.65~192.168.0.126  

C子网的主机可用IP地址      
192.168.0.129~192.168.0.190 

D子网的主机可用IP地址      
192.168.0.193~192.168.0.254      

<center>4个子网的广播地址</center>

<img src="/images/Network/ip8.png" alt="img">

**3、C类等长子网划分 等分成8个子网**

<img src="/images/Network/ip9.png" alt="img">


8个子网的子网掩码都是：255.255.255.224/27     
A子网：192.168.0.1~192.168.0.30     
B子网：192.168.0.33~192.168.0.62     
C子网：192.168.0.65~192.168.0.94     
D子网：192.168.0.97~192.168.0.126     
E子网：192.168.0.129~192.168.0.158     
F子网：192.168.0.161~192.168.0.190     
G子网：192.168.0.193~192.168.0.222     
H子网：192.168.0.225~192.168.0.254     


**4、B类子网划分**

<img src="/images/Network/ip10.png" alt="img">

**5、A类子网划分**

<img src="/images/Network/ip11.png" alt="img">

**五、变长子网划分**


如果一个子网地址块的长度是原网段的(1/2)^n，那么     
子网的子网掩码，就是在原网段的子网掩码基础上增加n个1       
不等长的子网，它们的子网掩码也不同 

<img src="/images/Network/ip12.png" alt="img">

假设上图是对192.168.0.0/24进行变长子网划分     
C网段：子网掩码是255.255.255.128/25     
B网段：子网掩码是255.255.255.192/26     
A网段：子网掩码是255.255.255.224/27     
D网段：子网掩码是255.255.255.252/30     
E网段：子网掩码是255.255.255.252/30     


<!-- ************************************************ -->
## <a id="content4"></a>超网

这2台设备能正常通信么？

<img src="/images/Network/ip13.png" alt="img">

|编号| 计算机0 |计算机1|
|IP| 192.168.0.10/24 |192.168.10.10/16
|子网掩码|255.255.255.0|255.255.0.0|
|网段|192.168.0.0|192.168.0.0|

我们在Packet Tracer上模拟下，在计算机0 执行ping指令
```
C:\>ping 192.168.10.10

Pinging 192.168.10.10 with 32 bytes of data:

Request timed out.
Request timed out.
Request timed out.
Request timed out.

Ping statistics for 192.168.10.10:
    Packets: Sent = 4, Received = 0, Lost = 4 (100% loss),

```

我们可以看到并能到达计算机1，说明它们不在一个网段。但通过合并我们可以让两台计算机正常通讯，将计算机0的子网掩码
改为255.255.0.0，即可实现两台计算机的正常通讯

**一、超网 - 合并2个网段**

超网：跟子网反过来，它是将多个连续的网段合并成一个更大的网段      
需求：原本有200台计算机使用192.168.0.0/24网段，现在希望增加200台设备到同一个网     
   
200台在192.168.0.0/24网段，     
200台在192.168.1.0/24网段      
合并     
192.168.0.0/24、192.168.1.0/24    
为一个网段：    
192.168.0.0/23（子网掩码往左移动1位）   

<img src="/images/Network/ip14.png" alt="img">


**思考：192.168.0.255/23这个IP地址，可以分配给计算机使用么？**

|IP地址|  11000000.10101000.00000000.11111111|
|子网掩码| 11111111.11111111.11111110.00000000|

网络ID： 11000000.10101000.0000000      
主机ID：0.11111111

可以使用，主机ID非全0也非全1  


**二、超网 - 合并4个网段**

子网掩码向左移动2位，可以合并4个网段

<img src="/images/Network/ip15.png" alt="img">

将        
192.168.0.0/24、        
192.168.1.0/24、        
192.168.2.0/24、        
192.168.3.0/24        
合并为        
192.168.0.0/22网段        


**思考：下面的2个网段，能通过子网掩码向左移动1位进行合并么？**

<img src="/images/Network/ip16.png" alt="img">

不可以


**三、合并网段的规律**


假设n是2的k次幂（k≥1）      
子网掩码左移k位能够将能够合并n个网段     

<img src="/images/Network/ip17.png" alt="img">


假设n是2的k次幂（k≥1）      
如果第一个网段的网络号能被n整除，那么由它开始连续的n个网段，能通过左移k位子网掩码进行合并     

比如     
第一个网段的网络号以二进制0结尾，那么由它开始连续的2个网段，能通过左移1位子网掩码进行合并     
第一个网段的网络号以二进制00结尾，那么由它开始连续的4个网段，能通过左移2位子网掩码进行合并     
第一个网段的网络号以二进制000结尾，那么由它开始连续的8个网段，能通过左移3位子网掩码进行合并     

**四、判断一个网段是子网还是超网**


首先
看看该网段的类型，是A类网络、B类网络、C类网络？    
默认情况下，A类子网掩码的位数是8，B类子网掩码的位数是16，C类子网掩码的位数是24   

然后    
如果该网段的子网掩码位数比默认子网掩码多，就是子网    
如果该网段的子网掩码位数比默认子网掩码少，则是超网   

比如    
25.100.0.0/16 是一个A类子网      
200.100.0.0/16是一个C类超网   


----------
>  行者常至，为者常成！


