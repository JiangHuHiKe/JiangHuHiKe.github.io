---
layout: post
title: "22、补充"
date: 2020-11-28
description: ""
tag: 网络协议
---



- [参考：【MJ亲授】网络协议从入门到底层原理](https://ke.qq.com/course/2900359)



## 目录

* [VPN](#content1)
* [tcpdump](#content2)
* [cache](#content3)




<!-- ************************************************ -->
## <a id="content1"></a>VPN

**一、VPN介绍**

VPN（Virtual Private Network），译为：虚拟私人网络     
它可以在公共网络上建立专用网络，进行加密通讯    

<center>VPN示意图一</center>
<img src="/images/Network/buchong1.png" alt="img">
使用VPN需要：VPN Client、VPN Server     
安装VPN Client的客户端发送的数据会被加密发送到VPN Server，这就保证了在公网上传输的数据是加密的   

如果我们从外网通过VPN访问公司的内网资源如何实现呢？     
从图中可以看出 VPN Server 到 资源服务器 之间这段数据是没有加密的，    
所以要想从外网访问公司的内网资源，将VPN Server架设在公司内部，这样就可以保证公司内网资源的安全     

<center>VPN示意图二</center>
<img src="/images/Network/buchong2.png" alt="img">

**二、VPN作用**

<img src="/images/Network/buchong3.png" alt="img">

1、提高上网的安全性   
VPN Client 与 VPN Server之间是加密传输的

2、保护公司内部资料       
公司内部的资料设置为只能内部访问和VPN Server访问     

3、隐藏上网者的身份    
因为数据是加密的，数据在公网传输时，Hacker、ISP、Government并不知道发送者的身份和发送的内容 

4、突破网站的地域限制       
有些网站针对不同地区的用户展示不同的内容，或相同的商品在不同地区价格不同，比如这个网站在美国               
如果我们想看该网站在日本的内容和价格，我们可以通过访问日本的VPN Server访问美国这个网站        

5、突破网络封锁            
因为有GFW（Great Firewall of China 中国长城防火墙）的限制（比如IP限制），有些网站在国内上不了      
但有些VPN Server 是没有加入到限制名单的，我们可以通过购买这些VPN Server提供的服务来访问被限制的国外网站，科学上网

**三、VPN与代理服务器的区别**

我们发现VPN的作用跟代理服务器有些类似，那他们的区别是什么？

1、软件      
VPN一般需要安装VPN客户端软件       
代理不需要安装额外的软件    

2、安全性       
VPN默认会对数据进行加密         
代理默认不会对数据进行加密（数据最终是否加密取决于使用的协议本身）    

3、费用       
一般情况下，VPN比代理贵       


**四、VPN的实现原理**

VPN的实现原理是：使用了隧道协议（Tunneling Protocol）  

常见的VPN隧道协议有      
PPTP（Point to Point Tunneling Protocol）：点对点隧道协议      
L2TP（Layer Two Tunneling Protocol）：第二层隧道协议      
IPsec（Internet Protocol Security）：互联网安全协议      
SSL VPN（如OpenVPN）      
...
      
这些协议是在哪一层起作用呢？     
传输层。比如HTTP协议和HTTPS协议都可以使用VPN技术。       

<!-- ************************************************ -->
## <a id="content2"></a>tcpdump


tcpdump是Linux平台的抓包分析工具，Windows版本是WinDump   

使用手册            
[https://www.tcpdump.org/manpages/tcpdump.1.html](https://www.tcpdump.org/manpages/tcpdump.1.html)

不错的教程         
[https://danielmiessler.com/study/tcpdump/](https://danielmiessler.com/study/tcpdump/)      

<!-- ************************************************ -->
## <a id="content3"></a>cache

**一、介绍**

Cache的发音跟Cash（现金）一样 ：美 /kæʃ/ 

1、缓存的简单逻辑

<img src="/images/Network/buchong4.png" alt="img">

浏览器向服务器请求资源     
无缓存：服务器响应，200 OK，资源缓存到本地     
有缓存：使用本地缓存        

实际上，HTTP的缓存机制远远比上图的流程要复杂     
通常会缓存的情况是：GET请求 + 静态资源（比如HTML、CSS、JS、图片等）     
Ctrl + F5：可以强制刷新缓存     

2、缓存的存储     

Memory Cache：内存缓存    
Dist Cache：磁盘缓存    
<img src="/images/Network/buchong5.png" alt="img">

**二、缓存 - 响应头**

1、Pragma：作用类似于Cache-Control，HTTP/1.0的产物   

2、Expires：缓存的过期时间（GMT格式时间），HTTP/1.0的产物   

3、Cache-Control：设置缓存策略      
✓ no-storage：不缓存数据到本地      
✓ public：允许用户、代理服务器缓存数据到本地      
✓ private：只允许用户缓存数据到本地      
✓ max-age：缓存的有效时间（多长时间不过期），单位秒      
✓ no-cache：每次需要发请求给服务器询问缓存是否有变化，再来决定如何使用缓存  

<img src="/images/Network/buchong6.png" alt="img">

优先级：Pragma > Cache-Control > Expires      

4、Last-Modified：资源的最后一次修改时间 

5、ETag：资源的唯一标识（根据文件内容计算出来的摘要值）      
优先级：ETag > Last-Modified      


**三、缓存 - 请求头** 

1、

If-None-Match      
如果上一次的响应头中有ETag，就会将ETag的值作为请求头的值      
如果服务器发现资源的最新摘要值跟If-None-Match不匹配，就会返回新的资源（200 OK）       
否则，就不会返回资源的具体数据（304 Not Modified）       

If-Modified-Since      
如果上一次的响应头中没有ETag，有Last-Modified，就会将Last-Modified的值作为请求头的值      
如果服务器发现资源的最后一次修改时间晚于If-Modified-Since，就会返回新的资源（200 OK）       
否则，就不会返回资源的具体数据（304 Not Modified）      

2、

Last-Modified的缺陷      
只能精确到秒级别，如果资源在1秒内被修改了，客户端将无法获取最新的资源数据      
如果某些资源被修改了（最后一次修改时间发生了变化），但是内容并没有任何变化      
会导致相同数据重复传输，没有使用到缓存      

ETag可以办到      
只要资源的内容没有变化，就不会重复传输资源数据      
只要资源的内容发生了变化，就会返回最新的资源数据给客户端      

**四、缓存的使用流程图**

<img src="/images/Network/buchong7.png" alt="img">











----------
>  行者常至，为者常成！


